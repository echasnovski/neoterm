#!/usr/bin/env bash

_pwd() {
  cd "$1" || exit 1
  pwd
}

_vim() {
  VIMBIN="vim vim -T dumb --not-a-term -u ${PLUGIN_PATH}/test-config/vim/vimrc"

  _test
}

_nvim() {
  VIMBIN="nvim --headless"
  XDG_CONFIG_HOME="${PLUGIN_PATH}/test-config"
  export XDG_CONFIG_HOME

  _test
}

_test() {
  $VIMBIN +"VMTestRun neoterm" +"VMTestQuit"
}

[ "$PLUGIN_PATH" = "" ] && PLUGIN_PATH="$(_pwd "$(dirname "$0")/..")"
[ "$VMTEST_PATH" = "" ] && VMTEST_PATH="$(_pwd "${PLUGIN_PATH}/../vmtest")"

export PLUGIN_PATH
export VMTEST_PATH

case "$1" in
  vim)
    _vim
    ;;
  all)
    echo "---"
    echo "vim"
    echo "---"
    _vim
    echo "------"
    echo "neovim"
    echo "------"
    _nvim
    ;;
  *)
    _nvim
    ;;
esac
